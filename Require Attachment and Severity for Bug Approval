import com.atlassian.jira.component.ComponentAccessor

def targetProjectKey = "NOLIA"
def allowedIssueType = "Bug"
def allowedSeverities = ["High", "Critical"]

def issue = issue
def project = issue.projectObject

if (project.key != targetProjectKey || issue.issueType.name != allowedIssueType) {
    return true
}

def attachments = ComponentAccessor.attachmentManager.getAttachments(issue)
if (!attachments || attachments.isEmpty()) {
    invalid("You must add at least one attachment before requesting approval.")
}

def severity = issue.getCustomFieldValue(
    ComponentAccessor.customFieldManager.getCustomFieldObjectByName("Severity")
) as String

if (!(severity in allowedSeverities)) {
    invalid("The Severity must be set to High or Critical before this transition.")
}

return true
